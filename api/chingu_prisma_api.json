{
  "server.js": "const express = require(\"express\");\nconst cors = require(\"cors\");\nconst { PrismaClient } = require(\"@prisma/client\");\n\nconst prisma = new PrismaClient();\nconst app = express();\n\napp.use(cors());\napp.use(express.json());\n\n// GET /members\n// Optional query params:\n//   gender, countryCode, countryName, roleType, voyageRole,\n//   soloProjectTier, voyageTier, voyage, yearJoined\napp.get(\"/members\", async (req, res) => {\n  try {\n    const {\n      gender,\n      countryCode,\n      countryName,\n      roleType,\n      voyageRole,\n      soloProjectTier,\n      voyageTier,\n      voyage,\n      yearJoined,\n      goal,\n      source,\n    } = req.query;\n\n    const where = {};\n\n    if (gender) where.gender = gender;\n    if (countryCode) where.country_code = countryCode;\n    if (countryName) where.country_name = countryName;\n    if (roleType) where.role_type = roleType;\n    if (voyageRole) where.voyage_role = voyageRole;\n    if (soloProjectTier) where.solo_project_tier = soloProjectTier;\n    if (voyageTier) where.voyage_tier = voyageTier;\n    if (voyage) where.voyage = voyage;\n    if (goal) where.goal = goal;\n    if (source) where.source = source;\n\n    if (yearJoined) {\n      const yearNum = Number(yearJoined);\n      if (!Number.isNaN(yearNum)) {\n        const start = new Date(Date.UTC(yearNum, 0, 1));\n        const end = new Date(Date.UTC(yearNum + 1, 0, 1));\n        where.timestamp = { gte: start, lt: end };\n      }\n    }\n\n    const members = await prisma.chinguMember.findMany({\n      where,\n      orderBy: { timestamp: \"desc\" },\n    });\n\n    res.json(members);\n  } catch (err) {\n    console.error(\"Error in /members:\", err);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n});\n\n// GET /countries\n// Returns an array like:\n// [ { country_code, country_name, count }, ... ]\napp.get(\"/countries\", async (req, res) => {\n  try {\n    const rows = await prisma.chinguMember.findMany({\n      select: {\n        country_code: true,\n        country_name: true,\n      },\n    });\n\n    const map = {};\n    for (const row of rows) {\n      const code = row.country_code || \"UNKNOWN\";\n      if (!map[code]) {\n        map[code] = {\n          country_code: row.country_code,\n          country_name: row.country_name,\n          count: 0,\n        };\n      }\n      map[code].count += 1;\n    }\n\n    res.json(Object.values(map));\n  } catch (err) {\n    console.error(\"Error in /countries:\", err);\n    res.status(500).json({ error: \"Internal server error\" });\n  }\n});\n\nconst PORT = process.env.PORT || 4000;\napp.listen(PORT, () => {\n  console.log(`API server listening on port ${PORT}`);\n});",
  "package.json": "{\n  \"name\": \"server\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Chingu Member Demographics API using Prisma + PostgreSQL\",\n  \"main\": \"server.js\",\n  \"scripts\": {\n    \"dev\": \"node server.js\"\n  },\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"@prisma/client\": \"^6.19.0\",\n    \"prisma\": \"^6.19.0\",\n    \"express\": \"^4.19.2\",\n    \"cors\": \"^2.8.5\"\n  }\n}"
}